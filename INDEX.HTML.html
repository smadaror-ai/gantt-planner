<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×˜×‘×œ×ª ×’×× ×˜ - ×¤×¨×¡×•× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Heebo:wght@400;500;600;700&family=Alef:wght@400;700&family=Assistant:wght@400;500;600;700&family=Varela+Round&family=Amatic+SC:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family, 'Segoe UI'), Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 20px;
            min-height: 100vh;
            transition: background 0.3s;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --cell-color: #e8f5e9;
            --font-family: 'Segoe UI';
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            transition: background 0.3s;
        }
        
        .logo-container {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            max-width: 150px;
            max-height: 80px;
        }
        
        .logo-container img {
            max-width: 100%;
            max-height: 80px;
            object-fit: contain;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .customization-panel {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .customization-panel h3 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 1.2em;
        }
        
        .custom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .custom-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .custom-item label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        .color-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-input:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .color-code {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            flex: 1;
        }
        
        .logo-upload {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        
        .file-label {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            font-weight: 600;
        }
        
        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .remove-logo {
            padding: 10px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .remove-logo:hover {
            background: #c82333;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            align-items: center;
        }
        
        .week-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            grid-column: span 3;
        }
        
        .week-selector label {
            font-weight: 600;
            color: #495057;
        }
        
        .week-selector input {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 15px;
            border: 1px solid var(--primary-color);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 13px;
            color: var(--primary-color);
            white-space: nowrap;
            width: 100%;
            text-align: center;
        }
        
        .btn-primary {
            border: 1px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            border-color: transparent;
        }
        
        .btn-secondary {
            border: 1px solid #6c757d;
            background: white;
            color: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #6c757d;
            color: white;
            border-color: transparent;
        }
        
        .gantt-wrapper {
            padding: 30px;
            overflow-x: auto;
        }
        
        .gantt-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .gantt-table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
            position: sticky;
            top: 0;
            z-index: 10;
            transition: background 0.3s;
        }
        
        .gantt-table td {
            padding: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
            vertical-align: middle;
        }
        
        .gantt-table tr:hover {
            background: #f8f9fa;
        }
        
        .task-cell {
            text-align: right;
            font-weight: 600;
            background: #f8f9fa;
            color: #495057;
            width: 200px;
        }
        
        .platform-cell {
            text-align: right;
            color: #6c757d;
            width: 150px;
        }
        
        .day-cell {
            position: relative;
            height: 60px;
            padding: 5px;
        }
        
        .cell-input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-family: inherit;
            font-size: 13px;
            resize: none;
            padding: 5px;
            outline: none;
            transition: all 0.2s;
        }
        
        .cell-input:focus {
            background: #fff8e1;
            box-shadow: inset 0 0 0 1px var(--primary-color);
            border-radius: 4px;
        }
        
        .cell-input:not(:placeholder-shown) {
            background: var(--cell-color);
            font-weight: 500;
            border-radius: 4px;
        }
        
        .cell-wrapper {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .cell-controls {
            display: flex;
            gap: 5px;
            padding: 2px;
            background: rgba(255,255,255,0.9);
            border-radius: 4px 4px 0 0;
        }
        
        .status-btn {
            padding: 2px 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .status-planning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-inprogress {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .cell-input.status-planning {
            background: #fff3cd !important;
        }
        
        .cell-input.status-inprogress {
            background: #cce5ff !important;
        }
        
        .cell-input.status-completed {
            background: #d4edda !important;
            text-decoration: line-through;
        }
        
        .priority-indicator {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 5;
        }
        
        .priority-high {
            background: #e74c3c;
            box-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
        }
        
        .priority-medium {
            background: #ff9800;
        }
        
        .priority-low {
            background: #ff1493;
        }
        
        .cell-notes {
            font-size: 10px;
            color: #6c757d;
            padding: 2px 5px;
            background: rgba(255,255,255,0.9);
            border-radius: 0 0 4px 4px;
            max-height: 30px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .stats-panel {
            padding: 20px 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-top: 1px solid #dee2e6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }
        
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid var(--primary-color);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            width: 200px;
            padding: 10px;
        }
        
        .context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 5px;
            background: white;
            border: 1px solid transparent;
        }
        
        .context-menu-item:hover {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%) !important;
            color: white !important;
            transform: scale(1.05);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .context-menu-item:last-child {
            margin-bottom: 0;
        }
        
        .legend {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #dee2e6;
        }
        
        .legend-box.filled {
            background: var(--cell-color);
        }
        
        .legend-box.empty {
            background: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            overflow: auto;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .modal-header h2 {
            color: var(--primary-color);
            margin: 0;
        }
        
        .close-modal {
            font-size: 30px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 30px;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        .template-section {
            margin-bottom: 25px;
        }
        
        .template-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .template-grid {
            display: grid;
            gap: 10px;
        }
        
        .template-row {
            display: grid;
            grid-template-columns: 200px 150px 2fr 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .template-input {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .template-select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 13px;
        }
        
        .saved-templates {
            margin-top: 20px;
        }
        
        .template-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .template-info {
            flex: 1;
        }
        
        .template-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .template-details {
            font-size: 13px;
            color: #6c757d;
        }
        
        .template-actions {
            display: flex;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .template-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
        
        .toggle-custom {
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .toggle-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .custom-content {
            display: none;
        }
        
        .custom-content.active {
            display: block;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .controls, .btn, .customization-panel {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
            }
            
            .cell-input {
                border: none !important;
                background: transparent !important;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .logo-container {
                position: static;
                transform: none;
                margin-bottom: 15px;
                text-align: center;
            }
            
            .controls, .custom-grid {
                flex-direction: column;
                align-items: stretch;
            }
            
            .gantt-wrapper {
                padding: 15px;
            }
            
            .cell-input {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container" id="logoContainer" style="display: none;">
                <img id="logoImage" src="" alt="×œ×•×’×•">
            </div>
            <h1>×’×× ×˜ ×¢×‘×•×“×” ×©×‘×•×¢×™</h1>
            <p>×ª×›× ×•×Ÿ ×©×‘×•×¢×™ ×œ×¢×‘×•×“×” ××™×©×™×ª ×•×¤×¨×¡×•××™× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª</p>
        </div>
        
        <div class="customization-panel">
            <button class="toggle-custom" onclick="toggleCustomization()">ğŸ¨ ×”×ª×××” ××™×©×™×ª</button>
            
            <div class="custom-content" id="customContent">
                <h3>×¢×™×¦×•×‘ ×”×˜×‘×œ×”</h3>
                <div class="custom-grid">
                    <div class="custom-item">
                        <label>×’×•×¤×Ÿ:</label>
                        <select id="fontSelect" class="template-select" onchange="changeFont()">
                            <option value="Segoe UI">Segoe UI (×‘×¨×™×¨×ª ××—×“×œ)</option>
                            <option value="Rubik">Rubik - ×¢×’×•×œ ×•××•×“×¨× ×™</option>
                            <option value="Heebo">Heebo - × ×§×™ ×•××§×¦×•×¢×™</option>
                            <option value="Alef">Alef - ××œ×’× ×˜×™</option>
                            <option value="Assistant">Assistant - ×™×“×™×“×•×ª×™</option>
                            <option value="Varela Round">Varela Round - ×¢×“×™×Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="custom-item">
                        <label>×¦×‘×¢ ×¨××©×™:</label>
                        <div class="color-input-wrapper">
                            <input type="color" class="color-input" id="primaryColor" value="#667eea">
                            <input type="text" class="color-code" id="primaryColorCode" value="#667eea" readonly>
                        </div>
                    </div>
                    
                    <div class="custom-item">
                        <label>×¦×‘×¢ ××©× ×™:</label>
                        <div class="color-input-wrapper">
                            <input type="color" class="color-input" id="secondaryColor" value="#764ba2">
                            <input type="text" class="color-code" id="secondaryColorCode" value="#764ba2" readonly>
                        </div>
                    </div>
                    
                    <div class="custom-item">
                        <label>×¦×‘×¢ ×¨×§×¢ ×ª××™× ×¢× ×ª×•×›×Ÿ:</label>
                        <div class="color-input-wrapper">
                            <input type="color" class="color-input" id="cellColor" value="#e8f5e9">
                            <input type="text" class="color-code" id="cellColorCode" value="#e8f5e9" readonly>
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">×œ×•×’×• ×”×¢×¡×§</h3>
                <div class="logo-upload">
                    <div class="file-input-wrapper">
                        <input type="file" id="logoInput" accept="image/*">
                        <label for="logoInput" class="file-label">ğŸ“¤ ×”×¢×œ××ª ×œ×•×’×•</label>
                    </div>
                    <button class="remove-logo" onclick="removeLogo()">ğŸ—‘ï¸ ×”×¡×¨ ×œ×•×’×•</button>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="week-selector">
                <label>×ª×¦×•×’×”:</label>
                <select id="viewType" class="week-selector input" onchange="changeView()" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                    <option value="weekly">×©×‘×•×¢×™</option>
                    <option value="monthly">×—×•×“×©×™</option>
                    <option value="halfyearly">×—×¦×™ ×©× ×ª×™</option>
                    <option value="yearly">×©× ×ª×™</option>
                </select>
            </div>
            <div class="week-selector" id="weekSelector">
                <label>×©×‘×•×¢:</label>
                <input type="week" id="weekInput" />
            </div>
            <div class="week-selector" id="monthSelector" style="display: none;">
                <label>×—×•×“×©:</label>
                <input type="month" id="monthInput" />
            </div>
            <div class="week-selector" id="halfyearSelector" style="display: none;">
                <label>×—×¦×™ ×©× ×”:</label>
                <select id="halfyearInput" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                    <option value="1">××—×¦×™×ª ×¨××©×•× ×”</option>
                    <option value="2">××—×¦×™×ª ×©× ×™×™×”</option>
                </select>
                <input type="number" id="halfyearYear" placeholder="×©× ×”" min="2020" max="2050" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; width: 100px;">
            </div>
            <div class="week-selector" id="yearSelector" style="display: none;">
                <label>×©× ×”:</label>
                <input type="number" id="yearInput" placeholder="2024" min="2020" max="2050" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; width: 120px;">
            </div>
            <button class="btn btn-primary" onclick="window.printTable()">ğŸ–¨ï¸ ×”×“×¤×¡ / ×©××•×¨ PDF</button>
            <button class="btn btn-primary" onclick="window.exportToCalendar()">ğŸ“… ×™×™×¦× ×œ×œ×•×— ×©× ×”</button>
            <button class="btn btn-primary" onclick="window.duplicateLastPeriod()">ğŸ“‹ ×©×›×¤×œ ×ª×§×•×¤×” ×§×•×“××ª</button>
            <button class="btn btn-primary" onclick="window.openTemplateModal()">âš™ï¸ ×ª×‘× ×™×•×ª</button>
            <button class="btn btn-primary" onclick="window.toggleStats()">ğŸ“ˆ ×¡×˜×˜×™×¡×˜×™×§×”</button>
            <button class="btn btn-secondary" onclick="window.clearAll()" id="clearAllBtn">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
        </div>
        
        <div class="gantt-wrapper">
            <table class="gantt-table" id="ganttTable">
                <thead>
                    <tr>
                        <th>××©×™××”</th>
                        <th>×¤×œ×˜×¤×•×¨××”</th>
                        <th>×¨××©×•×Ÿ</th>
                        <th>×©× ×™</th>
                        <th>×©×œ×™×©×™</th>
                        <th>×¨×‘×™×¢×™</th>
                        <th>×—××™×©×™</th>
                        <th>×©×™×©×™</th>
                        <th>×©×‘×ª</th>
                    </tr>
                </thead>
                <tbody id="ganttBody">
                </tbody>
            </table>
        </div>
        
        <div class="stats-panel" id="statsPanel" style="display: none;">
            <h3 style="color: #495057; margin-bottom: 10px;">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×”</h3>
            <div class="stats-grid" id="statsGrid">
                <!-- ×”×¡×˜×˜×™×¡×˜×™×§×” ×ª×™×•×•×¦×¨ ×›××Ÿ -->
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box filled"></div>
                <span>×ª× ×¢× ×ª×•×›×Ÿ</span>
            </div>
            <div class="legend-item">
                <div class="legend-box empty"></div>
                <span>×ª× ×¨×™×§</span>
            </div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #f8f9fa; color: #6c757d; font-size: 14px; border-top: 1px solid #dee2e6;">
            Â© ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª - SMADAR_OR_THE ART OF BRANDING
        </div>
    </div>
    
    <!-- Modal ×ª×‘× ×™×•×ª -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ × ×™×”×•×œ ×ª×‘× ×™×•×ª</h2>
                <button class="close-modal" onclick="closeTemplateModal()">&times;</button>
            </div>
            
            <div class="template-section">
                <h3>×™×¦×™×¨×ª ×ª×‘× ×™×ª ×—×“×©×”</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">×©× ×”×ª×‘× ×™×ª:</label>
                    <input type="text" id="templateName" class="template-input" placeholder="×œ×“×•×’××”: ×ª×‘× ×™×ª ×©×‘×•×¢×™×ª ×¨×’×™×œ×”" style="width: 100%;">
                </div>
                
                <div id="templateBuilder" class="template-grid">
                    <!-- ×©×•×¨×•×ª ×”×ª×‘× ×™×ª ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
                
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-primary btn-small" onclick="addTemplateRow()">â• ×”×•×¡×£ ×©×•×¨×”</button>
                    <button class="btn btn-primary" onclick="saveTemplate()">ğŸ’¾ ×©××•×¨ ×ª×‘× ×™×ª</button>
                </div>
            </div>
            
            <div class="template-section saved-templates">
                <h3>×ª×‘× ×™×•×ª ×©××•×¨×•×ª</h3>
                <div id="savedTemplatesList">
                    <p style="color: #6c757d; text-align: center;">××™×Ÿ ×ª×‘× ×™×•×ª ×©××•×¨×•×ª ×¢×“×™×™×Ÿ</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="window.setCellStatus('planning')">ğŸŸ¡ ×‘×ª×›× ×•×Ÿ</div>
        <div class="context-menu-item" onclick="window.setCellStatus('inprogress')">ğŸ”µ ×‘×‘×™×¦×•×¢</div>
        <div class="context-menu-item" onclick="window.setCellStatus('completed')">ğŸŸ¢ ×”×•×©×œ×</div>
        <div class="context-menu-item" onclick="window.setCellPriority('high')">ğŸ”´ ×¢×“×™×¤×•×ª ×’×‘×•×”×”</div>
        <div class="context-menu-item" onclick="window.setCellPriority('medium')">ğŸŸ  ×¢×“×™×¤×•×ª ×‘×™× ×•× ×™×ª</div>
        <div class="context-menu-item" onclick="window.setCellPriority('low')">ğŸ’— ×¢×“×™×¤×•×ª × ××•×›×”</div>
        <div class="context-menu-item" onclick="window.generateContentWithAI()">ğŸ’¡ ×¦×•×¨ ×ª×•×›×Ÿ ×¢× AI</div>
        <div class="context-menu-item" onclick="window.addCellNote()">ğŸ“ ×”×•×¡×£ ×”×¢×¨×”</div>
        <div class="context-menu-item" onclick="window.copyCellContent()">ğŸ“‹ ×”×¢×ª×§</div>
        <div class="context-menu-item" onclick="window.pasteCellContent()">ğŸ“Œ ×”×“×‘×§</div>
        <div class="context-menu-item" onclick="window.clearCell()">ğŸ—‘ï¸ × ×§×” ×ª×</div>
    </div>

    <script>
        const tasks = [
            { task: '×¤×•×¡×˜ ×¤×™×“', platforms: ['Instagram', 'Facebook', 'LinkedIn'] },
            { task: '×¡×˜×•×¨×™', platforms: ['Instagram', 'Facebook'] },
            { task: 'Reel / ×•×™×“××•', platforms: ['Instagram', 'TikTok', 'YouTube'] },
            { task: '×ª×’×•×‘×•×ª ×•××™× ×˜×¨××§×¦×™×”', platforms: ['×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª'] },
            { task: '×¢×‘×•×“×” ×¢×œ....', platforms: [''] },
            { task: '×¢×‘×•×“×” ×¢×œ....', platforms: [''] },
        ];

        const days = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];
        const months = ['×™× ×•××¨', '×¤×‘×¨×•××¨', '××¨×¥', '××¤×¨×™×œ', '×××™', '×™×•× ×™', '×™×•×œ×™', '××•×’×•×¡×˜', '×¡×¤×˜××‘×¨', '××•×§×˜×•×‘×¨', '× ×•×‘××‘×¨', '×“×¦××‘×¨'];
        
        let currentView = 'weekly';
        let tableState = {};
        let cellMetadata = {}; // ×¡×˜×˜×•×¡, ×¢×“×™×¤×•×ª, ×”×¢×¨×•×ª
        let savedTemplates = [];
        let templateRowCounter = 0;
        let selectedCell = null;
        let clipboardContent = null; // ××©×ª× ×” ×œ×©××™×¨×ª ×ª×•×›×Ÿ ××•×¢×ª×§
        let customSettings = {
            primaryColor: '#667eea',
            secondaryColor: '#764ba2',
            cellColor: '#e8f5e9',
            fontFamily: 'Segoe UI',
            logo: null
        };

        function toggleCustomization() {
            const content = document.getElementById('customContent');
            content.classList.toggle('active');
        }

        function changeView() {
            currentView = document.getElementById('viewType').value;
            
            // ×”×¡×ª×¨×ª ×›×œ ×”×¡×œ×§×˜×•×¨×™×
            document.getElementById('weekSelector').style.display = 'none';
            document.getElementById('monthSelector').style.display = 'none';
            document.getElementById('halfyearSelector').style.display = 'none';
            document.getElementById('yearSelector').style.display = 'none';
            
            // ×”×¦×’×ª ×”×¡×œ×§×˜×•×¨ ×”×¨×œ×•×•× ×˜×™
            if (currentView === 'weekly') {
                document.getElementById('weekSelector').style.display = 'flex';
            } else if (currentView === 'monthly') {
                document.getElementById('monthSelector').style.display = 'flex';
                setCurrentMonth();
            } else if (currentView === 'halfyearly') {
                document.getElementById('halfyearSelector').style.display = 'flex';
                setCurrentHalfYear();
            } else if (currentView === 'yearly') {
                document.getElementById('yearSelector').style.display = 'flex';
                setCurrentYear();
            }
            
            initTable();
        }

        function setCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            document.getElementById('monthInput').value = `${year}-${month}`;
        }

        function setCurrentHalfYear() {
            const now = new Date();
            const month = now.getMonth();
            document.getElementById('halfyearYear').value = now.getFullYear();
            document.getElementById('halfyearInput').value = month < 6 ? '1' : '2';
        }

        function setCurrentYear() {
            const now = new Date();
            document.getElementById('yearInput').value = now.getFullYear();
        }

        function initTable() {
            const tbody = document.getElementById('ganttBody');
            const thead = document.querySelector('.gantt-table thead tr');
            tbody.innerHTML = '';
            
            // ×™×¦×™×¨×ª ×›×•×ª×¨×•×ª ×œ×¤×™ ×¡×•×’ ×”×ª×¦×•×’×”
            let headers = ['××©×™××”', '×¤×œ×˜×¤×•×¨××”'];
            let columnCount = 0;
            
            if (currentView === 'weekly') {
                // ×—×™×©×•×‘ ×ª××¨×™×›×™× ×œ×©×‘×•×¢
                const weekInput = document.getElementById('weekInput').value;
                if (weekInput) {
                    const [year, week] = weekInput.split('-W');
                    const startDate = getDateOfWeek(parseInt(week), parseInt(year));
                    
                    for (let i = 0; i < 7; i++) {
                        const date = new Date(startDate);
                        date.setDate(startDate.getDate() + i);
                        const dateStr = `${date.getDate()}/${date.getMonth() + 1}`;
                        headers.push(`${days[i]}\n${dateStr}`);
                    }
                } else {
                    headers = headers.concat(days);
                }
                columnCount = 7;
            } else if (currentView === 'monthly') {
                const monthInput = document.getElementById('monthInput').value;
                if (monthInput) {
                    const [year, month] = monthInput.split('-');
                    const daysInMonth = new Date(year, month, 0).getDate();
                    const monthName = months[parseInt(month) - 1];
                    for (let i = 1; i <= daysInMonth; i++) {
                        const date = new Date(year, month - 1, i);
                        const dayName = days[date.getDay()];
                        headers.push(`${dayName}\n${i}/${month}`);
                    }
                    columnCount = daysInMonth;
                } else {
                    headers = headers.concat(Array.from({length: 31}, (_, i) => (i + 1).toString()));
                    columnCount = 31;
                }
            } else if (currentView === 'halfyearly') {
                const half = document.getElementById('halfyearInput').value;
                const startMonth = half === '1' ? 0 : 6;
                for (let i = startMonth; i < startMonth + 6; i++) {
                    headers.push(months[i]);
                }
                columnCount = 6;
            } else if (currentView === 'yearly') {
                headers = headers.concat(months);
                columnCount = 12;
            }
            
            // ×¢×“×›×•×Ÿ ×›×•×ª×¨×•×ª
            thead.innerHTML = '';
            headers.forEach(header => {
                const th = document.createElement('th');
                th.innerHTML = header.replace('\n', '<br>');
                th.style.whiteSpace = 'nowrap';
                thead.appendChild(th);
            });
            
            // ×™×¦×™×¨×ª ×©×•×¨×•×ª
            tasks.forEach((taskObj, taskIndex) => {
                taskObj.platforms.forEach((platform, platformIndex) => {
                    const row = document.createElement('tr');
                    
                    const taskCell = document.createElement('td');
                    taskCell.className = 'task-cell';
                    taskCell.textContent = platformIndex === 0 ? taskObj.task : '';
                    if (platformIndex === 0) {
                        taskCell.rowSpan = taskObj.platforms.length;
                    }
                    if (platformIndex === 0) row.appendChild(taskCell);
                    
                    const platformCell = document.createElement('td');
                    platformCell.className = 'platform-cell';
                    platformCell.textContent = platform;
                    row.appendChild(platformCell);
                    
                    for (let colIndex = 0; colIndex < columnCount; colIndex++) {
                        const dayCell = document.createElement('td');
                        dayCell.className = 'day-cell';
                        const cellId = `${currentView}-${taskIndex}-${platformIndex}-${colIndex}`;
                        
                        const wrapper = document.createElement('div');
                        wrapper.className = 'cell-wrapper';
                        
                        const textarea = document.createElement('textarea');
                        textarea.className = 'cell-input';
                        textarea.placeholder = '';
                        textarea.dataset.cellId = cellId;
                        
                        if (tableState[cellId]) {
                            textarea.value = tableState[cellId];
                        }
                        
                        // ×”×—×œ×ª ×¡×˜×˜×•×¡
                        const metadata = cellMetadata[cellId] || {};
                        if (metadata.status) {
                            textarea.classList.add(`status-${metadata.status}`);
                        }
                        
                        // ×”×•×¡×¤×ª × ×§×•×“×ª ×¢×“×™×¤×•×ª
                        if (metadata.priority) {
                            const priorityDot = document.createElement('div');
                            priorityDot.className = `priority-indicator priority-${metadata.priority}`;
                            wrapper.appendChild(priorityDot);
                        }
                        
                        textarea.addEventListener('input', function() {
                            tableState[cellId] = this.value;
                            saveState();
                        });
                        
                        // Context menu ×‘×œ×—×™×¦×” ×™×× ×™×ª
                        dayCell.addEventListener('contextmenu', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            selectedCell = cellId;
                            showContextMenu(e.clientX, e.clientY);
                            return false;
                        });
                        
                        wrapper.appendChild(textarea);
                        
                        // ×”×•×¡×¤×ª ×”×¢×¨×•×ª
                        if (metadata.note) {
                            const noteDiv = document.createElement('div');
                            noteDiv.className = 'cell-notes';
                            noteDiv.textContent = metadata.note;
                            noteDiv.title = metadata.note;
                            wrapper.appendChild(noteDiv);
                        }
                        
                        dayCell.appendChild(wrapper);
                        row.appendChild(dayCell);
                    }
                    
                    tbody.appendChild(row);
                });
            });
        }

        function saveState() {
            localStorage.setItem('ganttState', JSON.stringify(tableState));
            localStorage.setItem('cellMetadata', JSON.stringify(cellMetadata));
        }

        function loadState() {
            const saved = localStorage.getItem('ganttState');
            if (saved) {
                tableState = JSON.parse(saved);
            }
            const savedMeta = localStorage.getItem('cellMetadata');
            if (savedMeta) {
                cellMetadata = JSON.parse(savedMeta);
            }
        }

        function saveCustomSettings() {
            localStorage.setItem('customSettings', JSON.stringify(customSettings));
        }

        function loadCustomSettings() {
            const saved = localStorage.getItem('customSettings');
            if (saved) {
                customSettings = JSON.parse(saved);
                applyCustomSettings();
            }
            
            const savedTemplatesData = localStorage.getItem('savedTemplates');
            if (savedTemplatesData) {
                savedTemplates = JSON.parse(savedTemplatesData);
            }
        }

        function applyCustomSettings() {
            document.documentElement.style.setProperty('--primary-color', customSettings.primaryColor);
            document.documentElement.style.setProperty('--secondary-color', customSettings.secondaryColor);
            document.documentElement.style.setProperty('--cell-color', customSettings.cellColor);
            document.documentElement.style.setProperty('--font-family', customSettings.fontFamily);
            
            document.getElementById('primaryColor').value = customSettings.primaryColor;
            document.getElementById('secondaryColor').value = customSettings.secondaryColor;
            document.getElementById('cellColor').value = customSettings.cellColor;
            document.getElementById('fontSelect').value = customSettings.fontFamily;
            
            document.getElementById('primaryColorCode').value = customSettings.primaryColor;
            document.getElementById('secondaryColorCode').value = customSettings.secondaryColor;
            document.getElementById('cellColorCode').value = customSettings.cellColor;
            
            if (customSettings.logo) {
                document.getElementById('logoImage').src = customSettings.logo;
                document.getElementById('logoContainer').style.display = 'block';
            }
        }

        document.getElementById('primaryColor').addEventListener('input', function() {
            customSettings.primaryColor = this.value;
            document.getElementById('primaryColorCode').value = this.value;
            applyCustomSettings();
            saveCustomSettings();
        });

        document.getElementById('secondaryColor').addEventListener('input', function() {
            customSettings.secondaryColor = this.value;
            document.getElementById('secondaryColorCode').value = this.value;
            applyCustomSettings();
            saveCustomSettings();
        });

        document.getElementById('cellColor').addEventListener('input', function() {
            customSettings.cellColor = this.value;
            document.getElementById('cellColorCode').value = this.value;
            applyCustomSettings();
            saveCustomSettings();
        });

        function changeFont() {
            customSettings.fontFamily = document.getElementById('fontSelect').value;
            applyCustomSettings();
            saveCustomSettings();
        }

        document.getElementById('logoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    customSettings.logo = event.target.result;
                    applyCustomSettings();
                    saveCustomSettings();
                };
                reader.readAsDataURL(file);
            }
        });

        function removeLogo() {
            customSettings.logo = null;
            document.getElementById('logoContainer').style.display = 'none';
            document.getElementById('logoInput').value = '';
            saveCustomSettings();
        }

        window.clearAll = function() {
            if (confirm('×”×× ××ª ×‘×˜×•×—×” ×©×‘×¨×¦×•× ×š ×œ× ×§×•×ª ××ª ×›×œ ×”×ª×›× ×•×Ÿ? (×–×” ×™××—×§ ××ª ×›×œ ×”×ª×•×›×Ÿ ×•×”×¡×˜×˜×•×¡×™× ××š ×™×©××•×¨ ××ª ×”×”×’×“×¨×•×ª ×”××™×©×™×•×ª)')) {
                tableState = {};
                cellMetadata = {};
                saveState();
                initTable();
                alert('×ª×•×›×Ÿ ×”×˜×‘×œ×” × ×•×§×” ×‘×”×¦×œ×—×”! âœ…');
            }
        }

        window.printTable = function() {
            window.print();
        }

        window.exportToCalendar = function() {
            const weekInput = document.getElementById('weekInput').value;
            if (!weekInput && currentView === 'weekly') {
                alert('×‘×‘×§×©×” ×‘×—×¨×™ ×©×‘×•×¢ ×œ×¤× ×™ ×”×™×™×¦×•×');
                return;
            }

            // ×—×™×©×•×‘ ×ª××¨×™×š ×ª×—×™×œ×ª ×”×©×‘×•×¢
            const [year, week] = weekInput ? weekInput.split('-W') : [new Date().getFullYear(), 1];
            const startDate = getDateOfWeek(parseInt(week), parseInt(year));

            let icsContent = 'BEGIN:VCALENDAR\n';
            icsContent += 'VERSION:2.0\n';
            icsContent += 'PRODID:-//SMADAR_OR_THE ART OF BRANDING//Gantt//HE\n';
            icsContent += 'CALSCALE:GREGORIAN\n';
            icsContent += 'METHOD:PUBLISH\n';
            icsContent += 'X-WR-CALNAME:×’×× ×˜ ×¢×‘×•×“×” ×©×‘×•×¢×™\n';
            icsContent += 'X-WR-TIMEZONE:Asia/Jerusalem\n';

            let hasEvents = false;

            // ××¢×‘×¨ ×¢×œ ×›×œ ×”××©×™××•×ª
            tasks.forEach((taskObj, taskIndex) => {
                taskObj.platforms.forEach((platform, platformIndex) => {
                    days.forEach((day, dayIndex) => {
                        const cellId = `weekly-${taskIndex}-${platformIndex}-${dayIndex}`;
                        const content = tableState[cellId];

                        if (content && content.trim()) {
                            hasEvents = true;
                            const eventDate = new Date(startDate);
                            eventDate.setDate(startDate.getDate() + dayIndex);

                            const dateStr = formatDateForICS(eventDate);
                            const eventTitle = `${taskObj.task}${platform ? ' - ' + platform : ''}: ${content}`;

                            icsContent += 'BEGIN:VEVENT\n';
                            icsContent += `UID:${Date.now()}-${cellId}@gantt.local\n`;
                            icsContent += `DTSTAMP:${formatDateForICS(new Date())}\n`;
                            icsContent += `DTSTART;VALUE=DATE:${dateStr}\n`;
                            icsContent += `DTEND;VALUE=DATE:${dateStr}\n`;
                            icsContent += `SUMMARY:${eventTitle}\n`;
                            icsContent += `DESCRIPTION:${content}\\n\\n××§×•×¨: ×’×× ×˜ ×¢×‘×•×“×” ×©×‘×•×¢×™\n`;
                            icsContent += 'STATUS:CONFIRMED\n';
                            icsContent += 'SEQUENCE:0\n';
                            icsContent += 'END:VEVENT\n';
                        }
                    });
                });
            });

            icsContent += 'END:VCALENDAR';

            if (!hasEvents) {
                alert('××™×Ÿ ××©×™××•×ª ×œ×™×™×¦×. ×× × ××œ××™ ×ª×•×›×Ÿ ×‘×ª××™× ×œ×¤× ×™ ×”×™×™×¦×•×.');
                return;
            }

            // ×”×•×¨×“×ª ×”×§×•×‘×¥
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gantt-week-${weekInput || 'export'}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('×”×§×•×‘×¥ ×”×•×¨×“ ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×ª×•×›×œ×™ ×œ×™×™×‘× ××•×ª×• ×œ×œ×•×— ×”×©× ×” ×©×œ×š:\n\nğŸ“± Google Calendar: ×”×’×“×¨×•×ª â†’ ×™×™×‘×•× ×•×™×™×¦×•× â†’ ×‘×—×¨×™ ×§×•×‘×¥\nğŸ’¼ Outlook: ×§×•×‘×¥ â†’ ×¤×ª×— ×•×™×™×¦× â†’ ×™×™×‘×•×/×™×™×¦×•× â†’ ×™×™×‘×•× ×§×•×‘×¥ iCalendar');
        }

        function getDateOfWeek(week, year) {
            const simple = new Date(year, 0, 1 + (week - 1) * 7);
            const dow = simple.getDay();
            const ISOweekStart = simple;
            if (dow <= 4)
                ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
            else
                ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
            return ISOweekStart;
        }

        function formatDateForICS(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function setCurrentWeek() {
            const now = new Date();
            const weekInput = document.getElementById('weekInput');
            const year = now.getFullYear();
            const week = getWeekNumber(now);
            weekInput.value = `${year}-W${week.toString().padStart(2, '0')}`;
        }

        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // ×©×›×¤×•×œ ×ª×§×•×¤×” ×§×•×“××ª
        window.duplicateLastPeriod = function() {
            if (currentView === 'weekly') {
                const weekInput = document.getElementById('weekInput').value;
                if (!weekInput) {
                    alert('×‘×‘×§×©×” ×‘×—×¨×™ ×©×‘×•×¢ × ×•×›×—×™ ×ª×—×™×œ×”');
                    return;
                }
                
                const [year, week] = weekInput.split('-W');
                let prevWeek = parseInt(week) - 1;
                let prevYear = parseInt(year);
                
                if (prevWeek < 1) {
                    prevWeek = 52;
                    prevYear -= 1;
                }
                
                const prevWeekKey = `weekly`;
                let copiedCount = 0;
                
                tasks.forEach((taskObj, taskIndex) => {
                    taskObj.platforms.forEach((platform, platformIndex) => {
                        for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                            const prevCellId = `${prevWeekKey}-${taskIndex}-${platformIndex}-${dayIndex}`;
                            const currentCellId = `${currentView}-${taskIndex}-${platformIndex}-${dayIndex}`;
                            
                            if (tableState[prevCellId]) {
                                tableState[currentCellId] = tableState[prevCellId];
                                copiedCount++;
                            }
                        }
                    });
                });
                
                if (copiedCount > 0) {
                    saveState();
                    initTable();
                    alert(`×©×•×›×¤×œ×• ${copiedCount} ××©×™××•×ª ××”×©×‘×•×¢ ×”×§×•×“×! âœ…`);
                } else {
                    alert('×œ× × ××¦××• ××©×™××•×ª ×‘×©×‘×•×¢ ×”×§×•×“× ×œ×©×›×¤×•×œ');
                }
            } else {
                alert('×©×›×¤×•×œ ×ª×§×•×¤×” ×§×•×“××ª ×–××™×Ÿ ×›×¨×’×¢ ×¨×§ ×‘×ª×¦×•×’×” ×©×‘×•×¢×™×ª');
            }
        }

        // ×¤×ª×™×—×ª ×—×œ×•×Ÿ ×ª×‘× ×™×•×ª
        window.openTemplateModal = function() {
            document.getElementById('templateModal').style.display = 'block';
            loadSavedTemplates();
            if (document.getElementById('templateBuilder').children.length === 0) {
                addTemplateRow();
            }
        }

        function closeTemplateModal() {
            document.getElementById('templateModal').style.display = 'none';
        }

        // ×”×•×¡×¤×ª ×©×•×¨×” ×œ×‘× ×™×™×ª ×ª×‘× ×™×ª
        function addTemplateRow() {
            const builder = document.getElementById('templateBuilder');
            const rowId = templateRowCounter++;
            
            const row = document.createElement('div');
            row.className = 'template-row';
            row.id = `template-row-${rowId}`;
            row.style.gridTemplateColumns = '200px 150px 1fr 1fr auto';
            
            const taskSelect = document.createElement('select');
            taskSelect.className = 'template-select';
            taskSelect.innerHTML = tasks.map((t, i) => `<option value="${i}">${t.task}</option>`).join('');
            
            const platformSelect = document.createElement('select');
            platformSelect.className = 'template-select';
            platformSelect.innerHTML = '<option value="">×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª</option>';
            
            taskSelect.addEventListener('change', function() {
                const taskIndex = parseInt(this.value);
                platformSelect.innerHTML = '<option value="">×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª</option>' + 
                    tasks[taskIndex].platforms.map((p, i) => `<option value="${i}">${p}</option>`).join('');
            });
            
            const taskIndex = 0;
            platformSelect.innerHTML += tasks[taskIndex].platforms.map((p, i) => `<option value="${i}">${p}</option>`).join('');
            
            // ×‘×—×™×¨×ª ×™××™× ××¨×•×‘×™×
            const daysContainer = document.createElement('div');
            daysContainer.style.display = 'flex';
            daysContainer.style.gap = '5px';
            daysContainer.style.flexWrap = 'wrap';
            
            days.forEach((day, index) => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `day-${rowId}-${index}`;
                checkbox.value = index;
                checkbox.style.marginLeft = '5px';
                
                const label = document.createElement('label');
                label.htmlFor = `day-${rowId}-${index}`;
                label.textContent = day;
                label.style.fontSize = '12px';
                label.style.marginLeft = '8px';
                label.style.cursor = 'pointer';
                
                const wrapper = document.createElement('div');
                wrapper.style.display = 'flex';
                wrapper.style.alignItems = 'center';
                
                wrapper.appendChild(checkbox);
                wrapper.appendChild(label);
                daysContainer.appendChild(wrapper);
            });
            
            const contentInput = document.createElement('input');
            contentInput.type = 'text';
            contentInput.className = 'template-input';
            contentInput.placeholder = '×ª×•×›×Ÿ ×‘×¨×™×¨×ª ××—×“×œ...';
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'btn btn-secondary btn-small';
            removeBtn.textContent = 'ğŸ—‘ï¸';
            removeBtn.onclick = () => row.remove();
            
            row.appendChild(taskSelect);
            row.appendChild(platformSelect);
            row.appendChild(daysContainer);
            row.appendChild(contentInput);
            row.appendChild(removeBtn);
            
            builder.appendChild(row);
        }

        // ×©××™×¨×ª ×ª×‘× ×™×ª
        function saveTemplate() {
            const templateName = document.getElementById('templateName').value.trim();
            if (!templateName) {
                alert('× × ×œ×”×–×™×Ÿ ×©× ×œ×ª×‘× ×™×ª');
                return;
            }
            
            const rows = document.querySelectorAll('#templateBuilder .template-row');
            if (rows.length === 0) {
                alert('× × ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×©×•×¨×” ××—×ª ×œ×ª×‘× ×™×ª');
                return;
            }
            
            const template = {
                name: templateName,
                id: Date.now(),
                items: []
            };
            
            rows.forEach(row => {
                const selects = row.querySelectorAll('select');
                const input = row.querySelector('input[type="text"]');
                const checkboxes = row.querySelectorAll('input[type="checkbox"]:checked');
                
                // ×× × ×‘×—×¨×• ×™××™×
                if (checkboxes.length > 0) {
                    checkboxes.forEach(checkbox => {
                        template.items.push({
                            taskIndex: parseInt(selects[0].value),
                            platformIndex: selects[1].value === '' ? null : parseInt(selects[1].value),
                            dayIndex: parseInt(checkbox.value),
                            content: input.value
                        });
                    });
                }
            });
            
            if (template.items.length === 0) {
                alert('× × ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×™×•× ××—×“ ×‘×©×•×¨×•×ª ×”×ª×‘× ×™×ª');
                return;
            }
            
            savedTemplates.push(template);
            localStorage.setItem('savedTemplates', JSON.stringify(savedTemplates));
            
            document.getElementById('templateName').value = '';
            document.getElementById('templateBuilder').innerHTML = '';
            addTemplateRow();
            
            loadSavedTemplates();
            alert('×”×ª×‘× ×™×ª × ×©××¨×” ×‘×”×¦×œ×—×”! âœ…');
        }

        // ×˜×¢×™× ×ª ×ª×‘× ×™×•×ª ×©××•×¨×•×ª
        function loadSavedTemplates() {
            const list = document.getElementById('savedTemplatesList');
            
            if (savedTemplates.length === 0) {
                list.innerHTML = '<p style="color: #6c757d; text-align: center;">××™×Ÿ ×ª×‘× ×™×•×ª ×©××•×¨×•×ª ×¢×“×™×™×Ÿ</p>';
                return;
            }
            
            list.innerHTML = '';
            savedTemplates.forEach(template => {
                const item = document.createElement('div');
                item.className = 'template-item';
                
                const info = document.createElement('div');
                info.className = 'template-info';
                
                const name = document.createElement('div');
                name.className = 'template-name';
                name.textContent = template.name;
                
                const details = document.createElement('div');
                details.className = 'template-details';
                details.textContent = `${template.items.length} ××©×™××•×ª`;
                
                info.appendChild(name);
                info.appendChild(details);
                
                const actions = document.createElement('div');
                actions.className = 'template-actions';
                
                const applyBtn = document.createElement('button');
                applyBtn.className = 'btn btn-primary btn-small';
                applyBtn.textContent = 'âœ“ ×”×—×œ';
                applyBtn.onclick = () => applyTemplate(template);
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-primary btn-small';
                editBtn.textContent = 'âœï¸ ×¢×¨×•×š';
                editBtn.onclick = () => editTemplate(template);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-secondary btn-small';
                deleteBtn.textContent = 'ğŸ—‘ï¸';
                deleteBtn.onclick = () => deleteTemplate(template.id);
                
                actions.appendChild(applyBtn);
                actions.appendChild(editBtn);
                actions.appendChild(deleteBtn);
                
                item.appendChild(info);
                item.appendChild(actions);
                
                list.appendChild(item);
            });
        }

        // ×¢×¨×™×›×ª ×ª×‘× ×™×ª
        function editTemplate(template) {
            // ×˜×¢×™× ×ª ×”×ª×‘× ×™×ª ×œ×¢×¨×™×›×”
            document.getElementById('templateName').value = template.name;
            document.getElementById('templateBuilder').innerHTML = '';
            
            // ×§×™×‘×•×¥ ××©×™××•×ª ×œ×¤×™ ××©×™××” ×•×¤×œ×˜×¤×•×¨××”
            const groupedItems = {};
            template.items.forEach(item => {
                const key = `${item.taskIndex}-${item.platformIndex}`;
                if (!groupedItems[key]) {
                    groupedItems[key] = {
                        taskIndex: item.taskIndex,
                        platformIndex: item.platformIndex,
                        days: [],
                        content: item.content
                    };
                }
                groupedItems[key].days.push(item.dayIndex);
            });
            
            // ×™×¦×™×¨×ª ×©×•×¨×•×ª ×¢×‘×•×¨ ×›×œ ×§×‘×•×¦×”
            Object.values(groupedItems).forEach(group => {
                const builder = document.getElementById('templateBuilder');
                const rowId = templateRowCounter++;
                
                const row = document.createElement('div');
                row.className = 'template-row';
                row.id = `template-row-${rowId}`;
                row.style.gridTemplateColumns = '200px 150px 1fr 1fr auto';
                
                const taskSelect = document.createElement('select');
                taskSelect.className = 'template-select';
                taskSelect.innerHTML = tasks.map((t, i) => 
                    `<option value="${i}" ${i === group.taskIndex ? 'selected' : ''}>${t.task}</option>`
                ).join('');
                
                const platformSelect = document.createElement('select');
                platformSelect.className = 'template-select';
                platformSelect.innerHTML = '<option value="">×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª</option>' + 
                    tasks[group.taskIndex].platforms.map((p, i) => 
                        `<option value="${i}" ${i === group.platformIndex ? 'selected' : ''}>${p}</option>`
                    ).join('');
                
                // ×‘×—×™×¨×ª ×™××™× ××¨×•×‘×™×
                const daysContainer = document.createElement('div');
                daysContainer.style.display = 'flex';
                daysContainer.style.gap = '5px';
                daysContainer.style.flexWrap = 'wrap';
                
                days.forEach((day, index) => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `day-${rowId}-${index}`;
                    checkbox.value = index;
                    checkbox.style.marginLeft = '5px';
                    checkbox.checked = group.days.includes(index);
                    
                    const label = document.createElement('label');
                    label.htmlFor = `day-${rowId}-${index}`;
                    label.textContent = day;
                    label.style.fontSize = '12px';
                    label.style.marginLeft = '8px';
                    label.style.cursor = 'pointer';
                    
                    const wrapper = document.createElement('div');
                    wrapper.style.display = 'flex';
                    wrapper.style.alignItems = 'center';
                    
                    wrapper.appendChild(checkbox);
                    wrapper.appendChild(label);
                    daysContainer.appendChild(wrapper);
                });
                
                const contentInput = document.createElement('input');
                contentInput.type = 'text';
                contentInput.className = 'template-input';
                contentInput.value = group.content;
                contentInput.placeholder = '×ª×•×›×Ÿ ×‘×¨×™×¨×ª ××—×“×œ...';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-secondary btn-small';
                removeBtn.textContent = 'ğŸ—‘ï¸';
                removeBtn.onclick = () => row.remove();
                
                row.appendChild(taskSelect);
                row.appendChild(platformSelect);
                row.appendChild(daysContainer);
                row.appendChild(contentInput);
                row.appendChild(removeBtn);
                
                builder.appendChild(row);
            });
            
            // ××—×™×§×ª ×”×ª×‘× ×™×ª ×”×™×©× ×” (×ª×™×©××¨ ××—×“×© ×‘×¢×ª ×”×©××™×¨×”)
            savedTemplates = savedTemplates.filter(t => t.id !== template.id);
            localStorage.setItem('savedTemplates', JSON.stringify(savedTemplates));
            loadSavedTemplates();
        }

        // ×”×—×œ×ª ×ª×‘× ×™×ª
        function applyTemplate(template) {
            if (currentView !== 'weekly') {
                alert('×”×—×œ×ª ×ª×‘× ×™×•×ª ×–××™× ×” ×›×¨×’×¢ ×¨×§ ×‘×ª×¦×•×’×” ×©×‘×•×¢×™×ª');
                return;
            }
            
            let appliedCount = 0;
            
            template.items.forEach(item => {
                const task = tasks[item.taskIndex];
                
                // ×× ×œ× ×¦×•×™×Ÿ ×¤×œ×˜×¤×•×¨××” ×¡×¤×¦×™×¤×™×ª, × ×—×™×œ ×¢×œ ×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª ×©×œ ×”××©×™××”
                if (item.platformIndex === null || item.platformIndex === '') {
                    task.platforms.forEach((platform, platformIndex) => {
                        const cellId = `${currentView}-${item.taskIndex}-${platformIndex}-${item.dayIndex}`;
                        tableState[cellId] = item.content;
                        appliedCount++;
                    });
                } else {
                    // × ×—×™×œ ×¨×§ ×¢×œ ×”×¤×œ×˜×¤×•×¨××” ×”×¡×¤×¦×™×¤×™×ª
                    const cellId = `${currentView}-${item.taskIndex}-${item.platformIndex}-${item.dayIndex}`;
                    tableState[cellId] = item.content;
                    appliedCount++;
                }
            });
            
            saveState();
            initTable();
            closeTemplateModal();
            alert(`×”×ª×‘× ×™×ª ×”×•×—×œ×” ×‘×”×¦×œ×—×”! × ×•×¡×¤×• ${appliedCount} ××©×™××•×ª âœ…`);
        }

        // ××—×™×§×ª ×ª×‘× ×™×ª
        function deleteTemplate(templateId) {
            if (!confirm('×”×× ××ª ×‘×˜×•×—×” ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×ª×‘× ×™×ª ×–×•?')) {
                return;
            }
            
            savedTemplates = savedTemplates.filter(t => t.id !== templateId);
            localStorage.setItem('savedTemplates', JSON.stringify(savedTemplates));
            loadSavedTemplates();
        }

        // ×¡×’×™×¨×ª Modal ×‘×œ×—×™×¦×” ××—×•×¥ ×œ×ª×•×›×Ÿ
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('templateModal');
            if (event.target === modal) {
                closeTemplateModal();
            }
            
            // ×¡×’×™×¨×ª context menu
            const contextMenu = document.getElementById('contextMenu');
            if (!event.target.closest('#contextMenu') && !event.target.closest('.day-cell')) {
                contextMenu.style.display = 'none';
            }
        });
        
        // ×× ×™×¢×ª ×¡×’×™×¨×” ×©×œ context menu ×‘×œ×—×™×¦×” ×¢×œ×™×•
        document.getElementById('contextMenu').addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // Context Menu Functions
        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            
            // ×¡×’×™×¨×ª ×ª×¤×¨×™×˜×™× ××—×¨×™×
            menu.style.display = 'none';
            
            // ×”×¦×’×” ×‘××™×§×•× ×”× ×›×•×Ÿ
            setTimeout(() => {
                menu.style.display = 'block';
                
                // ×”×•×¡×¤×ª ××¨×•×•×— ××”××™×§×•× ×”××§×•×¨×™ ×›×“×™ ×©×”×ª×¤×¨×™×˜ ×™×”×™×” ×’×œ×•×™
                const offsetY = 20; // ××¨×•×•×— ××”×§×œ×™×§
                menu.style.left = x + 'px';
                menu.style.top = (y + offsetY) + 'px';
                
                // ×•×™×“×•× ×©×”×ª×¤×¨×™×˜ ×œ× ×™×•×¦× ××”××¡×š
                const rect = menu.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    menu.style.left = (x - rect.width) + 'px';
                }
                if (rect.bottom > window.innerHeight) {
                    menu.style.top = (window.innerHeight - rect.height - 10) + 'px';
                }
            }, 10);
        }

        window.setCellStatus = function(status) {
            if (!selectedCell) return;
            
            if (!cellMetadata[selectedCell]) {
                cellMetadata[selectedCell] = {};
            }
            cellMetadata[selectedCell].status = status;
            saveState();
            initTable();
            document.getElementById('contextMenu').style.display = 'none';
        }

        window.setCellPriority = function(priority) {
            if (!selectedCell) return;
            
            if (!cellMetadata[selectedCell]) {
                cellMetadata[selectedCell] = {};
            }
            cellMetadata[selectedCell].priority = priority;
            saveState();
            initTable();
            document.getElementById('contextMenu').style.display = 'none';
        }

        window.addCellNote = function() {
            if (!selectedCell) return;
            
            const note = prompt('×”×–×™× ×™ ×”×¢×¨×”:');
            if (note !== null) {
                if (!cellMetadata[selectedCell]) {
                    cellMetadata[selectedCell] = {};
                }
                cellMetadata[selectedCell].note = note;
                saveState();
                initTable();
            }
            document.getElementById('contextMenu').style.display = 'none';
        }

        window.copyCellContent = function() {
            if (!selectedCell) return;
            
            const content = tableState[selectedCell];
            const metadata = cellMetadata[selectedCell];
            
            // ×©××™×¨×” ×‘×–×™×›×¨×•×Ÿ ×”×¤× ×™××™
            clipboardContent = {
                content: content || '',
                metadata: metadata ? JSON.parse(JSON.stringify(metadata)) : null
            };
            
            // ×”×¢×ª×§×” ×’× ×œ×œ×•×— ×”××¢×¨×›×ª
            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    alert('×”×ª×•×›×Ÿ ×”×•×¢×ª×§! âœ…');
                });
            } else {
                alert('×”×ª× ×¨×™×§ - ×œ× ×”×•×¢×ª×§ ×ª×•×›×Ÿ');
            }
            document.getElementById('contextMenu').style.display = 'none';
        }

        window.pasteCellContent = function() {
            if (!selectedCell || !clipboardContent) {
                alert('××™×Ÿ ×ª×•×›×Ÿ ×œ×”×“×‘×§×”');
                document.getElementById('contextMenu').style.display = 'none';
                return;
            }
            
            // ×”×“×‘×§×ª ×”×ª×•×›×Ÿ
            if (clipboardContent.content) {
                tableState[selectedCell] = clipboardContent.content;
            }
            
            // ×”×“×‘×§×ª ×”××˜××“××˜×” (×¡×˜×˜×•×¡, ×¢×“×™×¤×•×ª, ×”×¢×¨×”)
            if (clipboardContent.metadata) {
                cellMetadata[selectedCell] = JSON.parse(JSON.stringify(clipboardContent.metadata));
            }
            
            saveState();
            initTable();
            document.getElementById('contextMenu').style.display = 'none';
        }

        window.clearCell = function() {
            if (!selectedCell) return;
            
            if (confirm('×”×× ×œ××—×•×§ ××ª ×ª×•×›×Ÿ ×”×ª×?')) {
                delete tableState[selectedCell];
                delete cellMetadata[selectedCell];
                saveState();
                initTable();
            }
            document.getElementById('contextMenu').style.display = 'none';
        }

        // ×™×¦×™×¨×ª ×ª×•×›×Ÿ ×¢× AI
        window.generateContentWithAI = function() {
            if (!selectedCell) return;
            
            const content = tableState[selectedCell];
            
            if (!content || !content.trim()) {
                alert('× × ×œ×”×–×™×Ÿ ×ª×™××•×¨ ×©×œ ×”××©×™××” ×‘×ª× ×œ×¤× ×™ ×™×¦×™×¨×ª ×ª×•×›×Ÿ');
                document.getElementById('contextMenu').style.display = 'none';
                return;
            }
            
            // ××¦×™××ª ×¤×¨×˜×™ ×”××©×™××”
            const parts = selectedCell.split('-');
            const taskIndex = parseInt(parts[1]);
            const platformIndex = parseInt(parts[2]);
            const dayIndex = parseInt(parts[3]);
            
            const taskName = tasks[taskIndex].task;
            const platform = tasks[taskIndex].platforms[platformIndex];
            const dayName = currentView === 'weekly' ? days[dayIndex] : `×™×•× ${dayIndex + 1}`;
            
            // ×™×¦×™×¨×ª ×”×¤×¨×•××¤×˜
            const prompt = `×”×™×™ Claude! ×× ×™ ×¦×¨×™×›/×” ×¢×–×¨×” ×œ×™×¦×•×¨ ×ª×•×›×Ÿ ×œ×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª.

ğŸ“‹ ×¤×¨×˜×™ ×”××©×™××”:
â€¢ ×¡×•×’: ${taskName}
â€¢ ×¤×œ×˜×¤×•×¨××”: ${platform}
â€¢ ×™×•×: ${dayName}
â€¢ ×ª×™××•×¨: ${content}

×× × ×¦×•×¨ ×¢×‘×•×¨×™ ×ª×•×›×Ÿ ××§×¦×•×¢×™ ×•××¢× ×™×™×Ÿ ×©××ª××™× ×œ×¤×œ×˜×¤×•×¨××” ×•×œ×¡×•×’ ×”×¤×¨×¡×•×. ×›×œ×•×œ:
- ×˜×§×¡×˜ ××œ× ××•×›×Ÿ ×œ×¤×¨×¡×•×
- ×”××œ×¦×•×ª ×œ×”××©×˜××’×™×
- ×”×¦×¢×•×ª ×œ×¢×™×¦×•×‘/×ª××•× ×•×ª (×× ×¨×œ×•×•× ×˜×™)
- ×˜×™×¤×™× ×œ×©×™×¤×•×¨ ×”×× ×’×™×™×’'×× ×˜

×ª×•×“×”! ğŸ™`;
            
            // ×¤×ª×™×—×ª ×©×™×—×” ×—×“×©×” ×¢× Claude
            const claudeUrl = `https://claude.ai/new?q=${encodeURIComponent(prompt)}`;
            window.open(claudeUrl, '_blank');
            
            document.getElementById('contextMenu').style.display = 'none';
            
            // ×”×¦×’×ª ×”×•×“×¢×” ×œ××©×ª××©
            setTimeout(() => {
                alert('× ×¤×ª×— ×˜××‘ ×—×“×© ×¢× Claude! ğŸ‰\n\n×œ××—×¨ ×©×ª×§×‘×œ/×™ ××ª ×”×ª×•×›×Ÿ, ×”×¢×ª×§/×™ ××•×ª×• ×‘×—×–×¨×” ×œ×ª× ×‘×’×× ×˜.');
            }, 500);
        }

        // ×™×™×¦×•× ×œ-Excel/CSV
        window.exportToExcel = function() {
            let csv = '××©×™××”,×¤×œ×˜×¤×•×¨××”,';
            
            let columnCount = 0;
            if (currentView === 'weekly') {
                csv += days.join(',');
                columnCount = 7;
            } else if (currentView === 'monthly') {
                const monthInput = document.getElementById('monthInput').value;
                if (monthInput) {
                    const [year, month] = monthInput.split('-');
                    const daysInMonth = new Date(year, month, 0).getDate();
                    csv += Array.from({length: daysInMonth}, (_, i) => i + 1).join(',');
                    columnCount = daysInMonth;
                }
            } else if (currentView === 'halfyearly') {
                const half = document.getElementById('halfyearInput').value;
                const startMonth = half === '1' ? 0 : 6;
                const monthNames = [];
                for (let i = startMonth; i < startMonth + 6; i++) {
                    monthNames.push(months[i]);
                }
                csv += monthNames.join(',');
                columnCount = 6;
            } else if (currentView === 'yearly') {
                csv += months.join(',');
                columnCount = 12;
            }
            
            csv += '\n';
            
            tasks.forEach((taskObj, taskIndex) => {
                taskObj.platforms.forEach((platform, platformIndex) => {
                    csv += `"${taskObj.task}","${platform}",`;
                    
                    const cells = [];
                    for (let colIndex = 0; colIndex < columnCount; colIndex++) {
                        const cellId = `${currentView}-${taskIndex}-${platformIndex}-${colIndex}`;
                        const content = tableState[cellId] || '';
                        cells.push(`"${content}"`);
                    }
                    csv += cells.join(',') + '\n';
                });
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gantt-${currentView}-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('×”×§×•×‘×¥ ×™×•×¦× ×‘×”×¦×œ×—×”! × ×™×ª×Ÿ ×œ×¤×ª×•×— ××•×ª×• ×‘-Excel âœ…');
        }

        // ×¡×˜×˜×™×¡×˜×™×§×”
        window.toggleStats = function() {
            const panel = document.getElementById('statsPanel');
            if (panel.style.display === 'none') {
                calculateStats();
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function calculateStats() {
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = '';
            
            let totalTasks = 0;
            let completedTasks = 0;
            let inProgressTasks = 0;
            let planningTasks = 0;
            let tasksByDay = {};
            let tasksByPlatform = {};
            
            // ×¡×¤×™×¨×ª ××©×™××•×ª
            Object.keys(tableState).forEach(cellId => {
                if (tableState[cellId] && tableState[cellId].trim()) {
                    totalTasks++;
                    
                    const metadata = cellMetadata[cellId] || {};
                    if (metadata.status === 'completed') completedTasks++;
                    else if (metadata.status === 'inprogress') inProgressTasks++;
                    else if (metadata.status === 'planning') planningTasks++;
                    
                    // ×¡×¤×™×¨×” ×œ×¤×™ ×™×•×
                    const parts = cellId.split('-');
                    const dayIndex = parseInt(parts[parts.length - 1]);
                    const dayName = currentView === 'weekly' ? days[dayIndex] : `×™×•× ${dayIndex + 1}`;
                    tasksByDay[dayName] = (tasksByDay[dayName] || 0) + 1;
                    
                    // ×¡×¤×™×¨×” ×œ×¤×™ ×¤×œ×˜×¤×•×¨××”
                    const taskIndex = parseInt(parts[1]);
                    const platformIndex = parseInt(parts[2]);
                    const platform = tasks[taskIndex].platforms[platformIndex];
                    if (platform) {
                        tasksByPlatform[platform] = (tasksByPlatform[platform] || 0) + 1;
                    }
                }
            });
            
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // ×›×¨×˜×™×¡×™ ×¡×˜×˜×™×¡×˜×™×§×”
            addStatCard(grid, totalTasks, '×¡×”"×› ××©×™××•×ª');
            addStatCard(grid, completedTasks, '×”×•×©×œ××•');
            addStatCard(grid, inProgressTasks, '×‘×‘×™×¦×•×¢');
            addStatCard(grid, planningTasks, '×‘×ª×›× ×•×Ÿ');
            addStatCard(grid, completionRate + '%', '××—×•×– ×”×©×œ××”');
            
            // ××©×™××•×ª ×œ×¤×™ ×™×•×
            const topDay = Object.entries(tasksByDay).sort((a, b) => b[1] - a[1])[0];
            if (topDay) {
                addStatCard(grid, `${topDay[0]}: ${topDay[1]}`, '×™×•× ×¢××•×¡ ×‘×™×•×ª×¨');
            }
            
            // ××©×™××•×ª ×œ×¤×™ ×¤×œ×˜×¤×•×¨××”
            const topPlatform = Object.entries(tasksByPlatform).sort((a, b) => b[1] - a[1])[0];
            if (topPlatform) {
                addStatCard(grid, `${topPlatform[0]}: ${topPlatform[1]}`, '×¤×œ×˜×¤×•×¨××” ××•×‘×™×œ×”');
            }
        }

        function addStatCard(container, value, label) {
            const card = document.createElement('div');
            card.className = 'stat-card';
            
            const valueDiv = document.createElement('div');
            valueDiv.className = 'stat-value';
            valueDiv.textContent = value;
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'stat-label';
            labelDiv.textContent = label;
            
            card.appendChild(valueDiv);
            card.appendChild(labelDiv);
            container.appendChild(card);
        }

        // ××ª×—×•×œ
        window.addEventListener('DOMContentLoaded', function() {
            loadState();
            loadCustomSettings();
            setCurrentWeek();
            initTable();
        });
    </script>
</body>
</html>